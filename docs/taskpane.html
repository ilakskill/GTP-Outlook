<!DOCTYPE html>
<html>
<head>
    <title>OpenAI API Test</title>
</head>
<body>


<form id="apikey-form">
    <div>
        <label for="apikey">API Key:</label>
        <input id="apikey" name="apikey" required type="text" />
    </div>
    //create a dropdown for roles using these values system, user, and assistant
    <div>
        <label for="role">Role:</label>
        <input id="role" name="role" required type="text" />
    </div>
    //create a dropdown for models using these values gpt-3.5-turbo, gpt-3.5, gpt-3.4, gpt-3.3, gpt-3.2, gpt-3.1, gpt-3.0, gpt-2.7, gpt-2.6, gpt-2.5, gpt-2.4, gpt-2.3, gpt-2.2, gpt-2.1, gpt-2.0, gpt-1.5, gpt-1.4, gpt-1.3, gpt-1.2, gpt-1.1, gpt-1.0, gpt-0.5, gpt-0.4, gpt-0.3, gpt-0.2, gpt-0.1, gpt-0.0, davinci, davinci-instruct-beta, davinci-instruct-beta-codex, davinci-instruct-beta-codex-2, davinci-instruct-beta-codex-3, davinci-instruct-beta-codex-4, davinci-instruct-beta-codex-5, davinci-instruct-beta-codex-6, davinci-instruct-beta-codex-7, davinci-instruct-beta-codex-8, davinci-instruct-beta-codex-9, davinci-instruct-beta-codex-10, davinci-instruct-beta-codex-11, davinci-instruct-beta-codex-12, davinci-instruct-beta-codex-13, davinci-instruct-beta-codex-14, davinci-instruct-beta-codex-15, davinci-instruct-beta-codex-16, davinci-instruct-beta-codex-17, davinci-instruct-beta-codex-18, davinci-instruct-beta-codex-19, davinci-instruct-beta-codex-20, davinci-instruct-beta-codex-21, davinci-instruct-beta-codex-22, davinci-instruct-beta-codex-23, davinci-instruct-beta-codex-24, davinci-instruct-beta-codex-25, davinci-instruct-beta-codex-26, davinci-instruct
    <div>
        <label for="model">Model:</label>
        <input id="model" name="model" required type="text" />
    </div>
    //create a dropdown for max_tokens using these values 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163
    <div>
        <label for="max_tokens">Max Tokens:</label>
        <input id="max_tokens" name="max_tokens" required type="text" />
    </div>
    //create a dropdown for temperature using these values 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0
    <div>
        <label for="temperature">Temperature:</label>
        <input id="temperature" name="temperature" required type="text" />
    </div>
    //create a dropdown for top_p using these values 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0
    <div>
        <label for="top_p">Top P:</label>
        <input id="top_p" name="top_p" required type="text" />
    </div>
    //create a dropdown for frequency_penalty using these values 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0
    <div>
        <label for="frequency_penalty">Frequency Penalty:</label>
        <input id="frequency_penalty" name="frequency_penalty" required type="text" />
    </div>
    //create a dropdown for presence_penalty using these values 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0
    <div>
        <label for="presence_penalty">Presence Penalty:</label>
        <input id="presence_penalty" name="presence_penalty" required type="text" />
    </div>
    //create a dropdown for stop using these values ., !, ?
    <div>
        <label for="stop">Stop:</label>
        <input id="stop" name="stop" required type="text" />
    </div>
    

    <label for="user-email-content">Email Body:</label>
        <textarea id="user-email-content" name="user-email-content"></textarea>
    <div>
        <button type="submit">Submit</button>
    </div>
</form>

<style>
    form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin: 1rem;
        padding: 1rem;
        border: 1px solid black;
        border-radius: 0.5rem;
    }

    label {
        font-weight: bold;
    }

    input,
    textarea {
        padding: 0.5rem;
        border-radius: 0.25rem;
        border: 1px solid #ccc;
    }

    button {
        padding: 0.5rem;
        border-radius: 0.25rem;
        background-color: #0078d4;
        color: white;
        font-weight: bold;
        border: none;
        cursor: pointer;
    }
</style>


<hr />
<div id="response"></div>

<script
        src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
        type="text/javascript"
></script>
<script type="text/javascript">
    Office.onReady(function() {
        // Get the current email item
        var item = Office.context.mailbox.item;

        // Get the body of the email as plain text
        item.getSelectedDataAsync(Office.CoercionType.Text, function (result) {
            if (result.status === Office.AsyncResultStatus.Succeeded) {
                // The plain text body of the email is in result.value
                console.log(result.value);
            } else {
                console.error(result.error.message);
            }
        });

        const form = document.getElementById("apikey-form");
        form.addEventListener("submit", (event) => {
            event.preventDefault();
            let apiKey = document.getElementById("apikey").value.trim();
            if (!apiKey) {
                apiKey = getCookie("apiKey");
            }
            const userEmailContent = document
                .getElementById("user-email-content")
                .value.trim();

            const payload = {
                messages: [
                    {
                        role: "system",
                        content:
                            "respond to this email.",
                    },
                    { role: "user", content: userEmailContent },
                ],
                model: "gpt-3.5-turbo",
                max_tokens: 2048,
                temperature: 0.7,
                n: 1,
                stream: false,
            };

            const url = "https://api.openai.com/v1/chat/completions";
            const headers = {
                "Content-Type": "application/json",
                Authorization: "Bearer " + apiKey,
            };

            fetch(url, {
                method: "POST",
                headers,
                body: JSON.stringify(payload),
            })
                .then((response) => response.json())
                .then((data) => {
                    const assistantMessage = data.choices[0].message.content;
                    const responseDiv = document.getElementById("response");

                    const messageHTML = `
          <div style="background-color: #F2F2F2; padding: 20px; border: 1px solid #E6E6E6;">
            <div style="color: #707070; font-size: 12px; margin-bottom: 10px;">Assistant:</div>
            <div style="padding: 10px; font-size: 16px; line-height: 1.5; background-color: #FFFFFF; border: 1px solid #E6E6E6; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">${assistantMessage}</div>
          </div>
        `;

                    responseDiv.innerHTML = messageHTML;

                   // the orginal is below
                    //document.cookie = `apiKey=${apiKey}`;

                    // Set the cookie expiration to 30 days from now
                    const daysUntilExpiration = 30;
                    const expirationDate = new Date();
                    expirationDate.setDate(expirationDate.getDate() + daysUntilExpiration);

                    document.cookie = `apiKey=${apiKey}; expires=${expirationDate.toUTCString()}`;
                })
                .catch((error) => console.error(error));
        });

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(";").shift();
        }
    });



</script>
</body>
</html>
