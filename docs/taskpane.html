<!DOCTYPE html>
<html>
  <head>
    <title>GPT Email Helper 11</title>
    <style>
      body {
          background-color: #f7f7f7;
          font-family: Arial, sans-serif;
      }

      form {
          display: flex;
          flex-direction: column;
          gap: 1rem;
          margin: 1rem;
          padding: 1rem;
          border: 1px solid #ddd;
          border-radius: 0.5rem;
          background-color: #fff;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      label {
          font-weight: bold;
          font-size: 1.1rem;
          color: #333;
          margin-bottom: 0.5rem;
      }

      button {
          padding: 0.5rem;
          border-radius: 0.25rem;
          background-color: #0078d4;
          color: #fff;
          font-weight: bold;
          border: none;
          cursor: pointer;
          transition: all 0.2s ease-in-out;
      }

      button:hover {
          background-color: #005a9e;
      }

      hr {
          margin: 2rem 0;
          border: none;
          border-top: 1px solid #ddd;
      }

      .response {
          background-color: #f2f2f2;
          padding: 20px;
          border: 1px solid #e6e6e6;
          border-radius: 5px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          margin-top: 2rem;
      }

      .response__content {
          padding: 10px;
          font-size: 16px;
          line-height: 1.5;
          background-color: #fff;
          border: 1px solid #e6e6e6;
          border-radius: 5px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>

  <body>
    <div id="response"></div>

    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script>
      function copyToClipboard(text) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
      }

      Office.onReady(() => {
        if (Office.context.mailbox.item) {
          handleEmailProcessing();
        }
      });

      async function handleEmailProcessing() {
        const apiKey = "YOUR_API_KEY"; // Replace with your actual API key
        const item = Office.context.mailbox.item;

        // Fetch the email body
        item.body.getAsync("text", async (result) => {
          if (result.status === Office.AsyncResultStatus.Succeeded) {
            const emailBody = result.value;

            const payload = {
              messages: [
                {
                  role: "system",
                  content: `You are a highly skilled Business Correspondence Editor. Enhance the professionalism, clarity, and tone of this email:`,
                },
                {
                  role: "user",
                  content: emailBody,
                },
              ],
              model: "gpt-4",
              max_tokens: 1000,
              temperature: 0.7,
            };

            try {
              const response = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${apiKey}`,
                },
                body: JSON.stringify(payload),
              });

              if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
              }

              const data = await response.json();
              const assistantMessage = data.choices[0].message.content;

              // Display the response
              const responseDiv = document.getElementById("response");
              responseDiv.innerHTML = `
                <div class="response">
                  <div class="response__content">${assistantMessage}</div>
                </div>
              `;

              // Copy the response to clipboard
              copyToClipboard(assistantMessage);
              alert("Generated response copied to clipboard!");
            } catch (error) {
              console.error("Error generating response:", error);
              alert("Failed to generate a response. Check the console for details.");
            }
          } else {
            console.error("Failed to fetch email body:", result.error);
          }
        });
      }
    </script>
  </body>
</html>
